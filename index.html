<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>观音灵签</title>
  <meta name="description" content="观音灵签 · 一方签文，千载智慧，照见古今人生路。">
  
  <style>
    /* 全局重置和基础样式 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      overflow-x: hidden;
      height: auto;
      min-height: 100vh;
    }

    body {
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      color: #333333;
      font-family: "苹方", -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Hiragino Sans GB, Microsoft YaHei UI, Microsoft YaHei, Source Han Sans CN, sans-serif;
      line-height: 1.5;
      padding: 20px 16px;
    }

    /* 主容器 */
    .app-container {
      max-width: 450px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    /* 标题区域 */
    .app-header {
      background: linear-gradient(135deg, #0052d9 0%, #003db3 100%);
      color: white;
      text-align: center;
      padding: 24px 20px;
    }

    .app-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .app-subtitle {
      font-size: 14px;
      opacity: 0.9;
      font-weight: 400;
    }

    /* 内容区域 */
    .app-content {
      padding: 24px 20px;
      min-height: 400px;
    }

    /* 观音灵签样式 */
    .guanyin-container {
      width: 100%;
    }

    /* 阶段内容 */
    .stage-content {
      display: none;
      width: 100%;
    }

    .stage-content.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .stage-title {
      font-size: 18px;
      line-height: 26px;
      color: #0052d9;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
    }

    .prayer-description {
      text-align: center;
      color: #666666;
      font-size: 16px;
      line-height: 24px;
      margin-bottom: 25px;
      font-weight: 400;
    }

    .prayer-description p {
      margin-bottom: 10px;
    }

    .prayer-btn {
      background: #0052d9;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 16px;
      line-height: 24px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
      font-weight: 600;
      display: block;
      margin: 0 auto;
      width: 100%;
    }

    .prayer-btn:hover {
      background: #003db3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 82, 217, 0.3);
    }

    .tube-shaking {
      display: flex;
      justify-content: center;
      margin: 30px 0;
      transform: scale(0.8);
    }

    /* 签筒主体 */
    .tube {
      width: 80px;
      height: 160px;
      background: #713300;
      border: 3px solid #532300;
      border-radius: 8px 8px 16px 16px;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      cursor: pointer;
    }

    .tube-cap {
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      height: 24px;
      background: #532300;
      border: 3px solid #3b1700;
      border-radius: 8px 8px 0 0;
      z-index: 10;
    }

    .tube-mask {
      position: absolute;
      top: 20px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      background: #713300;
      border: 3px solid #532300;
      border-top: none;
      border-radius: 0 0 16px 16px;
      z-index: 8;
    }

    .tube-band {
      position: absolute;
      left: -3px;
      right: -3px;
      height: 8px;
      background: #532300;
      border-left: 3px solid #3b1700;
      border-right: 3px solid #3b1700;
    }

    .tube-band:nth-child(2) {
      top: 50px;
    }

    .tube-band:nth-child(3) {
      bottom: 40px;
    }

    .lotus-pattern {
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      z-index: 9;
    }

    .lotus-pattern svg {
      width: 100%;
      height: 100%;
    }

    .stick {
      position: absolute;
      width: 6px;
      height: 120px;
      background: #fff0ed;
      border-radius: 3px;
      left: 50%;
      transform: translateX(-50%);
      top: 100px;
      z-index: 5;
      box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      opacity: 0;
    }

    .stick::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 20px;
      background: #881f1c;
      border-radius: 3px 3px 0 0;
    }

    .cups {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
    }

    .cup {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .cup svg {
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
      cursor: pointer;
      transition: transform 0.3s;
    }

    .cup svg:hover {
      transform: scale(1.1);
    }

    .cup-label {
      font-size: 12px;
      line-height: 20px;
      color: #0052d9;
      text-align: center;
      min-height: 20px;
      font-weight: 600;
    }

    /* 摇签动画 */
    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      10% { transform: rotate(-10deg); }
      20% { transform: rotate(10deg); }
      30% { transform: rotate(-10deg); }
      40% { transform: rotate(10deg); }
      50% { transform: rotate(-8deg); }
      60% { transform: rotate(8deg); }
      70% { transform: rotate(-6deg); }
      80% { transform: rotate(6deg); }
      90% { transform: rotate(-3deg); }
    }

    @keyframes stick-out {
      0%, 90% { 
        top: 100px;
        opacity: 0;
      }
      95% {
        top: -70px;
        opacity: 1;
      }
      100% { 
        top: -60px;
        opacity: 1;
      }
    }

    .tube.shaking {
      animation: shake 3s ease-in-out;
    }

    .tube.shaking .stick {
      animation: stick-out 3s ease-in-out forwards;
    }

    .tube.stick-visible .stick {
      top: -60px;
      opacity: 1;
    }

    .cup-result {
      text-align: center;
      color: #0052d9;
      font-size: 16px;
      line-height: 24px;
      margin-top: 20px;
      font-weight: 600;
    }

    .loading-text {
      text-align: center;
      color: #666666;
      font-size: 14px;
      line-height: 22px;
      margin: 20px 0;
      font-weight: 400;
    }

    .result-card {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
      margin-top: 20px;
    }

    .lottery-container {
      max-width: 100%;
    }

    .lottery-title {
      text-align: center;
      font-size: 18px;
      line-height: 26px;
      color: #0052d9;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .lottery-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 12px 15px;
      background: #f5f5f5;
      border-radius: 8px;
    }

    .lottery-number {
      font-size: 16px;
      line-height: 24px;
      color: #0052d9;
      font-weight: 600;
    }

    .lottery-type {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 20px;
      font-weight: 600;
    }

    .lottery-type.上签 { background: #d4edda; color: #155724; }
    .lottery-type.中签 { background: #fff3cd; color: #856404; }
    .lottery-type.下签 { background: #d54941; color: #fff; }

    .lottery-content {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .lottery-poetry, .lottery-meaning, .lottery-explanation {
      margin-bottom: 15px;
    }

    .lottery-poetry:last-child, 
    .lottery-meaning:last-child, 
    .lottery-explanation:last-child {
      margin-bottom: 0;
    }

    .lottery-poetry h4, .lottery-meaning h4, .lottery-explanation h4 {
      color: #0052d9;
      margin-bottom: 8px;
      font-size: 14px;
      line-height: 22px;
      font-weight: 600;
    }

    .lottery-poetry p, .lottery-meaning p, .lottery-explanation p {
      color: #666666;
      line-height: 22px;
      font-size: 14px;
      font-weight: 400;
    }

    /* 响应式设计 */
    @media (max-width: 480px) {
      body {
        padding: 16px 12px;
      }
      
      .app-container {
        border-radius: 12px;
      }
      
      .app-header {
        padding: 20px 16px;
      }
      
      .app-content {
        padding: 20px 16px;
      }
    }
  </style>
</head>

<body>
  <div class="app-container">
    <div class="app-header">
      <h1 class="app-title">观音灵签</h1>
      <p class="app-subtitle">一方签文，千载智慧，照见古今人生路。</p>
    </div>
    
    <div class="app-content">
      <div class="guanyin-container">
        <!-- 祈请阶段 -->
        <div id="prayer-content" class="stage-content active">
          <h2 class="stage-title">祈请观音灵签</h2>
          <div class="prayer-description">
            <p>请默想心愿，开始求签。<br>摇签后需掷筊确认，获"圣杯"方可解签。</p>
          </div>
          <button id="start-prayer-btn" class="prayer-btn">开始求签</button>
        </div>

        <!-- 摇签阶段 -->
        <div id="shaking-content" class="stage-content">
          <h2 class="stage-title">摇动签筒</h2>
          <div class="tube-shaking">
            <div class="tube" id="tube">
              <div class="tube-cap"></div>
              <div class="tube-band"></div>
              <div class="tube-band"></div>
              <div class="lotus-pattern">
                <svg viewBox="0 0 40 40" fill="none">
                  <path d="M20 8 Q16 16 20 24 Q24 16 20 8" stroke="#be5a00" stroke-width="1.5" fill="none"/>
                  <path d="M12 14 Q16 18 20 24 Q14 20 12 14" stroke="#be5a00" stroke-width="1.5" fill="none"/>
                  <path d="M28 14 Q24 18 20 24 Q26 20 28 14" stroke="#be5a00" stroke-width="1.5" fill="none"/>
                  <circle cx="20" cy="28" r="2" fill="#be5a00"/>
                </svg>
              </div>
              <div class="stick"></div>
              <div class="tube-mask"></div>
            </div>
          </div>
          <p class="loading-text">专注摇签中...</p>
        </div>

        <!-- 圣杯确认阶段 -->
        <div id="confirmation-content" class="stage-content">
          <h2 class="stage-title">圣杯确认</h2>
          <div class="cups">
            <div id="cup1" class="cup">
              <svg width="80" height="120" viewBox="0 0 80 120">
                <g transform="translate(40, 60) rotate(-90) translate(-40, -60)">
                  <path d="M 15 75 A 25 25 0 0 1 65 75 Z" 
                        fill="#8B0000" 
                        stroke="#000000" 
                        stroke-width="2"/>
                  <ellipse cx="40" cy="58" rx="12" ry="8" 
                           fill="rgba(255,255,255,0.2)"/>
                </g>
              </svg>
              <div class="cup-label"></div>
            </div>
            <div id="cup2" class="cup">
              <svg width="80" height="120" viewBox="0 0 80 120">
                <g transform="translate(40, 60) rotate(-90) translate(-40, -60)">
                  <path d="M 15 75 A 25 25 0 0 1 65 75 Z" 
                        fill="#8B0000" 
                        stroke="#000000" 
                        stroke-width="2"/>
                  <ellipse cx="40" cy="58" rx="12" ry="8" 
                           fill="rgba(255,255,255,0.2)"/>
                </g>
              </svg>
              <div class="cup-label"></div>
            </div>
          </div>
          <p id="cup-result" class="cup-result"></p>
          <button id="action-btn" class="prayer-btn" style="display: none; margin-top: 20px;">再求一签</button>
        </div>

        <!-- 签文详情 -->
        <div id="result-card" class="result-card">
          <div class="lottery-container">
            <h3 id="lottery-title" class="lottery-title"></h3>
            <div class="lottery-info">
              <div class="lottery-number">第<span id="lottery-id">1</span>签</div>
              <div class="lottery-type" id="lottery-type">上签</div>
            </div>
            <div class="lottery-content">
              <div class="lottery-poetry">
                <h4>诗曰：</h4>
                <p id="poetry-text"></p>
              </div>
              <div class="lottery-meaning">
                <h4>诗意：</h4>
                <p id="meaning-text"></p>
              </div>
              <div class="lottery-explanation">
                <h4>解曰：</h4>
                <p id="explanation-text"></p>
              </div>
            </div>
            <button id="restart-btn" class="prayer-btn">再求一签</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 观音灵签100签完整数据库
    const guanyinLotteryData = [
      {
        id: 1,
        title: "钟离成道",
        type: "上签子宫",
        poetry: "开天辟地作良缘。吉日良时万物全。若得此签非小可。人行忠正帝王宣。",
        meaning: "此卦盘古初开天地之象。诸事皆吉也。",
        explanation: "急速兆速。年未值时。观音降笔。先报君知。"
      },
      {
        id: 2,
        title: "苏秦不第",
        type: "中签子宫",
        poetry: "鲸鱼未变守江河。不可升腾更望高。异日峥嵘身变化。许君一跃跳龙门。",
        meaning: "此卦鲸鱼未变之象。凡事忍耐待时。",
        explanation: "得忍且忍。得耐且耐。身不须忙。功名自在。"
      },
      {
        id: 3,
        title: "董永遇仙",
        type: "上签子宫",
        poetry: "临风冒雨去还乡。正是其身似燕儿。衔得坭来欲作垒。到头垒坏复须坭。",
        meaning: "此卦燕子衔坭之象。凡事劳心费力也。",
        explanation: "千般用计。晨昏不停。谁知此事。到底劳心。"
      },
      {
        id: 4,
        title: "玉莲会十朋",
        type: "上签子宫",
        poetry: "千年古镜复重圆。女再求夫男再婚。自此门庭重改换。更添福禄在儿孙。",
        meaning: "此卦古镜重圆之象。凡事劳心有贵也。",
        explanation: "淘沙成金。骑龙踏虎。虽是劳心。于中有补。"
      },
      {
        id: 5,
        title: "刘晨遇仙",
        type: "中签丑宫",
        poetry: "一锥草地要求泉。努力求之得最难。无意俄然遇知己。相逢携手上青天。",
        meaning: "此卦锥地求泉之象。凡事先难后易也。",
        explanation: "欲望心事。西方可求。不如莫动。立地可谋。"
      },
      {
        id: 6,
        title: "仁贵遇主",
        type: "中签丑宫",
        poetry: "投身岩下铜鸟居。须是还他大丈夫。拾得营谋谁可得。通行天地此人无。",
        meaning: "此卦投岩铜鸟之象。凡事宜顺吉之兆。",
        explanation: "食用无余。身清岂贫。待时利乐。改旧从新。"
      },
      {
        id: 7,
        title: "苏秦佩印",
        type: "上签丑宫",
        poetry: "欲求胜事何须远。月在青天影在空。莫道远山无路透。果然此去有相逢。",
        meaning: "此卦明月当空之象。凡事自然成就也。",
        explanation: "谋望从心。婚姻合意。求财称遂。疾病安愈。"
      },
      {
        id: 8,
        title: "子龙救主",
        type: "上签丑宫",
        poetry: "怀抱玲珑见玉帝。方知女面胜男儿。鹏鸟飞来九万里。全凭扶振两翼垂。",
        meaning: "此卦鹏鸟飞腾之象。凡事有人扶助也。",
        explanation: "女人持家。胜过男子。千般用人。不如自己。"
      },
      {
        id: 9,
        title: "玄德私行",
        type: "中签丑宫",
        poetry: "一事去一程。一程去一事。要知山下路。须问过来人。",
        meaning: "此卦行人问路之象。凡事要寻良友也。",
        explanation: "出入求人。凡事成就。阴人引入。不失其时。"
      },
      {
        id: 10,
        title: "太公钓鱼",
        type: "上签寅宫",
        poetry: "渭水潺潺日夜深。持竿垂钓待浮沉。专寻直钩求心诺。得遇文王载德音。",
        meaning: "此卦渭水钓鱼之象。凡事耐心待时也。",
        explanation: "渭水钓鱼。八十载心。不言鱼味。君臣义深。"
      },
      {
        id: 11,
        title: "孔明求寿",
        type: "下签寅宫",
        poetry: "劝君作事须循理。切莫贪婪过用机。作恶多遭刑宪祸。为善终当有益之。",
        meaning: "此卦劝人作善之象。凡事要修德也。",
        explanation: "神明照察。善恶难欺。祈福禳灾。祈福最吉。"
      },
      {
        id: 12,
        title: "庞涓问道",
        type: "下签寅宫",
        poetry: "心同水道夜安流。顺水行舟免忧愁。帆风若转西南去。碧水潭中必见忧。",
        meaning: "此卦顺水行舟之象。凡事有阻隔也。",
        explanation: "行船不难。顺水无风。若遇西南。必见其功。"
      },
      {
        id: 13,
        title: "桃园结义",
        type: "上签寅宫",
        poetry: "一春二春花未红。三春桃花始正浓。等闲折取一枝去。路遇游人说鲁恭。",
        meaning: "此卦桃红柳绿之象。凡事和合大吉也。",
        explanation: "桃红柳绿。春正及时。花开堪折。折取一枝。"
      },
      {
        id: 14,
        title: "关羽降曹",
        type: "中签寅宫",
        poetry: "万里迢迢路远长。心忙步急欲还乡。争如守待春风至。一舟平安达大江。",
        meaning: "此卦行船遇风之象。凡事有贵人助也。",
        explanation: "行人欲回。步急心忙。争如守待。必遇贵人。"
      },
      {
        id: 15,
        title: "王道求雨",
        type: "上签卯宫",
        poetry: "久旱苗枯欲雨来。幸得天赐及时开。南风播得三春雨。田禾个个尽发哉。",
        meaning: "此卦天时和顺之象。凡事皆吉也。",
        explanation: "久旱逢甘雨。行船又顺风。求财称意。百事皆通。"
      },
      {
        id: 16,
        title: "徐庶荐贤",
        type: "中签卯宫",
        poetry: "明珠一颗土中埋。光明万丈放出来。若得此签为上吉。小人在旁嫉妒才。",
        meaning: "此卦明珠出土之象。凡事有贵人助也。",
        explanation: "明珠一颗。土中久埋。光明万丈。人人尽见。"
      },
      {
        id: 17,
        title: "韩信霸楚",
        type: "下签卯宫",
        poetry: "离别家乡已数年。如今依旧没田园。纵然得片瓦遮身体。料想前途不甚言。",
        meaning: "此卦困龙离水之象。凡事不利也。",
        explanation: "困龙离水。牛落深坑。虽有片瓦。不能遮身。"
      },
      {
        id: 18,
        title: "陶渊归隐",
        type: "中签卯宫",
        poetry: "桃源鸡犬识何年。风景依稀似往天。安得此身来旧观。武陵别自有渔船。",
        meaning: "此卦武陵桃源之象。凡事安逸也。",
        explanation: "桃源鸡犬。识有年岁。风景依稀。往日时天。"
      },
      {
        id: 19,
        title: "尾生抱柱",
        type: "下签卯宫",
        poetry: "君家何事尚蹉跎。久困深渊可奈何。幸得天开云雾见。此身安稳出江河。",
        meaning: "此卦困龙得水之象。凡事先凶后吉也。",
        explanation: "久困深渊。今得出头。云开见日。福禄自招。"
      },
      {
        id: 20,
        title: "张骞得胜",
        type: "上签辰宫",
        poetry: "半年辛苦半年闲。数载经营半载难。今朝秋日登高望。方觉云开见远山。",
        meaning: "此卦云开见日之象。凡事先难后易也。",
        explanation: "秋日登高。云开见日。困苦皆散。心下安然。"
      },
      {
        id: 21,
        title: "班师献捷",
        type: "上签辰宫",
        poetry: "阳春天气正芳菲。枝上黄莺逐对飞。身自逍遥无一事。坐看儿童乐忘归。",
        meaning: "此卦春和日暖之象。凡事安逸也。",
        explanation: "春和日暖。黄莺对飞。身心自在。坐看忘归。"
      },
      {
        id: 22,
        title: "李白骑鲸",
        type: "下签辰宫",
        poetry: "天高月黑夜沉沉。万籁无声寂夜心。多少游人行复止。桥头独坐一人吟。",
        meaning: "此卦夜静月明之象。凡事多思也。",
        explanation: "夜静月明。万籁无声。游人行止。桥坐独吟。"
      },
      {
        id: 23,
        title: "霸王别姬",
        type: "下签辰宫",
        poetry: "八尺将军数不成。千军万马莫相争。何如弃却凡间事。别却尘嚣访圣明。",
        meaning: "此卦英雄失志之象。凡事不利也。",
        explanation: "英雄失志。莫争强胜。弃却凡尘。访圣寻明。"
      },
      {
        id: 24,
        title: "季布一诺",
        type: "中签辰宫",
        poetry: "黄金百两未为轻。季布当时一诺行。若得此签为吉兆。凡事皆可用真情。",
        meaning: "此卦一诺千金之象。凡事有信也。",
        explanation: "一诺千金。季布信行。此为吉兆。用情必真。"
      },
      {
        id: 25,
        title: "张良辞汉",
        type: "中签巳宫",
        poetry: "欲上高楼去避风。谁知楼上更朦胧。不如且守田园乐。落得心闲志自雄。",
        meaning: "此卦辞官归隐之象。凡事退守为吉也。",
        explanation: "欲避风尘。楼更朦胧。不如守旧。心闲志雄。"
      },
      {
        id: 26,
        title: "伯牙碎琴",
        type: "下签巳宫",
        poetry: "马行千里路途遥。一阵狂风叶尽飘。贵人事急人相怨。此去前程渐寂寥。",
        meaning: "此卦风扫落叶之象。凡事有失也。",
        explanation: "马行千里。路正迢迢。狂风一阵。叶尽飘摇。"
      },
      {
        id: 27,
        title: "姜维破魏",
        type: "下签巳宫",
        poetry: "宝剑经年未出锋。尘埃满面匣中封。今日偶闻磨试者。方知利器匣中容。",
        meaning: "此卦宝剑藏匣之象。凡事待时也。",
        explanation: "宝剑藏匣。尘埃满面。今日磨试。方知利器。"
      },
      {
        id: 28,
        title: "梅杏二花",
        type: "上签巳宫",
        poetry: "梅杏花开春事浓。蜂蝶去采香更香。不如移向南枝上。占取春光第一功。",
        meaning: "此卦梅杏争春之象。凡事早为贵也。",
        explanation: "梅杏花开。春事正浓。蜂蝶采香。不如南枝。"
      },
      {
        id: 29,
        title: "刘智远仙",
        type: "中签巳宫",
        poetry: "一番事业一番新。只恐途中有患人。若得贵人来指示。方知此去可安身。",
        meaning: "此卦中途遇贵人之象。凡事有救也。",
        explanation: "事业一新。途有患人。得贵指示。方知安身。"
      },
      {
        id: 30,
        title: "韩信归汉",
        type: "上签午宫",
        poetry: "碧玉藏深石。珊瑚入海沙。幸天不弃微贱。一举成名天下夸。",
        meaning: "此卦明珠出土之象。凡事有贵人助也。",
        explanation: "碧玉藏石。珊瑚海沙。天不微贱。一举成名。"
      }
    ];

    // 观音灵签主逻辑
    class SimpleGuanyinLottery {
      constructor() {
        this.mainCard = document.getElementById('prayer-content');
        this.resultCard = document.getElementById('result-card');
        
        this.prayerContent = document.getElementById('prayer-content');
        this.shakingContent = document.getElementById('shaking-content');
        this.confirmationContent = document.getElementById('confirmation-content');
        
        this.cupResult = document.getElementById('cup-result');
        this.actionBtn = document.getElementById('action-btn');
        this.restartBtn = document.getElementById('restart-btn');
        
        this.init();
      }

      init() {
        document.getElementById('start-prayer-btn').addEventListener('click', () => {
          this.startPrayer();
        });

        this.actionBtn.addEventListener('click', () => {
          this.handleAction();
        });

        this.restartBtn.addEventListener('click', () => {
          this.restartLottery();
        });
      }

      switchContent(contentName) {
        // 隐藏所有内容
        this.prayerContent.classList.remove('active');
        this.shakingContent.classList.remove('active');
        this.confirmationContent.classList.remove('active');
        
        // 显示指定内容
        switch(contentName) {
          case 'shaking':
            this.shakingContent.classList.add('active');
            break;
          case 'confirmation':
            this.confirmationContent.classList.add('active');
            break;
          default:
            this.prayerContent.classList.add('active');
        }
      }

      startPrayer() {
        // 隐藏签文卡片
        this.resultCard.classList.remove('active');
        this.mainCard.style.display = 'block';
        
        // 重置按钮状态和签筒状态
        this.actionBtn.style.display = 'none';
        const tube = document.getElementById('tube');
        tube.classList.remove('shaking', 'stick-visible');
        
        // 开始摇签
        this.switchContent('shaking');
        this.startShakingAnimation();
      }

      startShakingAnimation() {
        const tube = document.getElementById('tube');
        tube.classList.remove('shaking', 'stick-visible');
        // 强制重排
        void tube.offsetHeight;
        tube.classList.add('shaking');
        
        setTimeout(() => {
          tube.classList.remove('shaking');
          tube.classList.add('stick-visible');
          // 签条弹出后停留1秒再加载下一个画面
          setTimeout(() => {
            this.performDivineConfirmation();
          }, 1000);
        }, 3000);
      }

      performDivineConfirmation() {
        this.switchContent('confirmation');
        // 先清空杯子内容，避免闪现
        document.getElementById('cup1').querySelector('svg').innerHTML = '';
        document.getElementById('cup2').querySelector('svg').innerHTML = '';
        document.getElementById('cup1').querySelector('.cup-label').textContent = '';
        document.getElementById('cup2').querySelector('.cup-label').textContent = '';
        this.cupResult.textContent = '';
        setTimeout(() => {
          this.showCupResult();
        }, 1000);
      }

      showCupResult() {
        const cup1Container = document.getElementById('cup1');
        const cup2Container = document.getElementById('cup2');
        
        const results = [
          { 
            cup1: 'convex', 
            cup2: 'flat', 
            text: '圣杯 - 阴阳相合，求事有成',
            label1: '凸面朝上',
            label2: '平面朝上',
            type: 'holy'
          },
          { 
            cup1: 'convex', 
            cup2: 'convex', 
            text: '笑杯 - 心意未定，诚心再求',
            label1: '凸面朝上',
            label2: '凸面朝上',
            type: 'smile'
          },
          { 
            cup1: 'flat', 
            cup2: 'flat', 
            text: '阴杯 - 时机未到，静待佳期',
            label1: '平面朝上',
            label2: '平面朝上',
            type: 'yin'
          },
          { 
            cup1: 'flat', 
            cup2: 'convex', 
            text: '圣杯 - 阴阳相合，求事有成',
            label1: '平面朝上',
            label2: '凸面朝上',
            type: 'holy'
          }
        ];
        
        const result = results[Math.floor(Math.random() * results.length)];
        
        // 先设置杯子图形
        cup1Container.querySelector('svg').innerHTML = this.getCupSVG(result.cup1);
        cup2Container.querySelector('svg').innerHTML = this.getCupSVG(result.cup2);
        
        // 清空文字，等动画结束后再显示
        this.cupResult.textContent = '';
        cup1Container.querySelector('.cup-label').textContent = '';
        cup2Container.querySelector('.cup-label').textContent = '';
        
        // 执行旋转动画
        this.animateCups(cup1Container.querySelector('svg'), cup2Container.querySelector('svg'));
        
        // 动画结束后（800ms）显示文字结果
        setTimeout(() => {
          this.cupResult.textContent = result.text;
          cup1Container.querySelector('.cup-label').textContent = result.label1;
          cup2Container.querySelector('.cup-label').textContent = result.label2;
        }, 800);
        
        // 再等待1.5秒后处理结果
        setTimeout(() => {
          this.handleCupResult(result);
        }, 2300);
      }

      getCupSVG(type) {
        if (type === 'convex') {
          return `
            <g transform="translate(40, 60) rotate(-90) translate(-40, -60)">
              <path d="M 15 75 A 25 25 0 0 1 65 75 Z" 
                    fill="#8B0000" 
                    stroke="#000000" 
                    stroke-width="2"/>
              <ellipse cx="40" cy="58" rx="12" ry="8" 
                       fill="rgba(255,255,255,0.2)"/>
            </g>
          `;
        } else {
          return `
            <g transform="translate(40, 60) rotate(-90) translate(-40, -60)">
              <path d="M 15 45 A 25 25 0 0 0 65 45 Z" 
                    fill="#8B0000" 
                    stroke="#000000" 
                    stroke-width="2"/>
              <line x1="18" y1="47" x2="62" y2="47" 
                    stroke="rgba(255,255,255,0.3)" 
                    stroke-width="1.5"/>
            </g>
          `;
        }
      }

      animateCups(cup1, cup2) {
        [cup1, cup2].forEach((cup, index) => {
          cup.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
          cup.style.transform = `rotate(${360 + index * 180}deg) scale(1.1)`;
          
          setTimeout(() => {
            cup.style.transform = 'rotate(0deg) scale(1)';
          }, 800);
        });
      }

      handleCupResult(result) {
        if (result.type === 'holy') {
          // 圣杯 - 显示签文详情页面
          this.mainCard.style.display = 'none';
          this.showLotteryResult();
          this.resultCard.classList.add('active');
        } else if (result.type === 'smile') {
          // 笑杯 - 显示重新摇签按钮
          this.actionBtn.textContent = '重新摇签';
          this.actionBtn.style.display = 'block';
          this.actionBtn.dataset.action = 'shake';
        } else {
          // 阴杯 - 显示重新祈请按钮
          this.actionBtn.textContent = '重新祈请';
          this.actionBtn.style.display = 'block';
          this.actionBtn.dataset.action = 'pray';
        }
      }

      showLotteryResult() {
        const selectedLottery = guanyinLotteryData[Math.floor(Math.random() * guanyinLotteryData.length)];
        
        document.getElementById('lottery-title').textContent = selectedLottery.title;
        document.getElementById('lottery-id').textContent = selectedLottery.id;
        
        const typeText = selectedLottery.type || '中签';
        document.getElementById('lottery-type').textContent = typeText;
        
        const typeClass = typeText.includes('上') ? '上签' : 
                         typeText.includes('下') ? '下签' : '中签';
        document.getElementById('lottery-type').className = 'lottery-type ' + typeClass;
        
        document.getElementById('poetry-text').textContent = selectedLottery.poetry;
        document.getElementById('meaning-text').textContent = selectedLottery.meaning;
        document.getElementById('explanation-text').textContent = selectedLottery.explanation;
      }

      handleAction() {
        const action = this.actionBtn.dataset.action;
        if (action === 'shake') {
          this.actionBtn.style.display = 'none';
          // 重置杯子内容和签筒状态
          this.cupResult.textContent = '';
          document.getElementById('cup1').querySelector('svg').innerHTML = '';
          document.getElementById('cup2').querySelector('svg').innerHTML = '';
          document.getElementById('cup1').querySelector('.cup-label').textContent = '';
          document.getElementById('cup2').querySelector('.cup-label').textContent = '';
          
          this.switchContent('shaking');
          this.startShakingAnimation();
        } else {
          this.restartLottery();
        }
      }

      restartLottery() {
        this.resultCard.classList.remove('active');
        this.mainCard.style.display = 'block';
        this.actionBtn.style.display = 'none';
        
        // 重置圣杯确认阶段的所有内容
        this.cupResult.textContent = '';
        document.getElementById('cup1').querySelector('svg').innerHTML = '';
        document.getElementById('cup2').querySelector('svg').innerHTML = '';
        document.getElementById('cup1').querySelector('.cup-label').textContent = '';
        document.getElementById('cup2').querySelector('.cup-label').textContent = '';
        
        this.switchContent('prayer');
        
        // 强制重排
        void this.mainCard.offsetHeight;
      }
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      new SimpleGuanyinLottery();
    });
  </script>
</body>
</html>
